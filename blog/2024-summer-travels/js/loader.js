const STATE = {
    '0': {
        'img': {
            '/blog/2024-summer-travels/img/0/banff-mountain.webp': null,
            '/blog/2024-summer-travels/img/0/jasper-lake-2.webp': null,
            '/blog/2024-summer-travels/img/0/campbell-river-dock.webp': null,
            '/blog/2024-summer-travels/img/0/sunset-beach-vancouver.webp': null,
            '/blog/2024-summer-travels/img/0/train-kamloops.webp': null,
            '/blog/2024-summer-travels/img/0/train-winnipeg.webp': null,
            '/blog/2024-summer-travels/img/0/ubc-rose-garden-vancouver.webp': null
        },
        'audio': {
            '/blog/2024-summer-travels/audio/0/Housekeeping (45s).mp3': null,
            '/blog/2024-summer-travels/audio/0/Xinjiang by Zimpzon.mp3': null
        },
        'md': null
    },
    'quebec': {
        'img': {
            '/blog/2024-summer-travels/img/quebec/CitadelleTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/DinnerTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/EscaliersTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/FlowersTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/GrassyHouseTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/LongshotChateauTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/MaraisTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/QuebecBridgeTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/UniLavalTrim.webp': null,
        },
        'audio': {
            '/blog/2024-summer-travels/audio/quebec/Art inspiration (1m).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Dot com era (35s).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Sentier (1m).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Trip context (1m).mp3': null,
        },
        'md': `
        # Ville de Québec

        <button data-src="/blog/2024-summer-travels/audio/quebec/Trip context (1m).mp3" class="narration-button">
            Why I went on this trip
        </button>
        <button data-src="/blog/2024-summer-travels/audio/quebec/Art inspiration (1m).mp3" class="narration-button narration-button-gap">
            Why I made this site
        </button>

        ![Longshot of Le Château Frontenac](/blog/2024-summer-travels/img/quebec/LongshotChateauTrim.webp)
        <figcaption>Long shot of Le Château Frontenac from a ferry</figcaption>

        ## Travels

        I'm surprised looking back at how nervous I was when I first got to Québec. I didn't feel comfortable speaking French and I didn't really know what to expect. I tend to go 0 to 1 real quick in a lot of domains, including when it comes to “easing into” my first solo trip :D I remember feeling nervous as I paid over a thousand dollars for my AirBnB thinking: “Wow, am I really doing this? There's literally nothing to determine whether to press the button other than what my heart decides.” 

        <blockquote>Foreshadowed lesson: press the @\#(\*\#@$ button\!</blockquote>

        As I arrived in Québec, tiny things started to go right to ease my nervousness. First off, I was living in such a lucky middlespot between Université Laval and Vieux Québec. My hosts were kind enough to lend me their bike and so I biked everywhere. Every destination had a journey of literal effort behind it, which made me appreciate each expedition that much more. I was even lucky enough to have a house on a bike only corridor so I'd just explore \- start riding in one direction to see how far the road went and then do the same in the other.   
        
        <button data-src="/blog/2024-summer-travels/audio/quebec/Sentier (1m).mp3" class="narration-button">
            Hidden jewels in the city
        </button>

        ![Pont de Québec](/blog/2024-summer-travels/img/quebec/QuebecBridgeTrim.webp)
        <figcaption>Pont de Québec. It's nice to bike to next to the river :-)</figcaption> 

        ![Random grass-covered house](/blog/2024-summer-travels/img/quebec/GrassyHouseTrim.webp) 
        <figcaption>Pretty house en route to Université Laval that reminded me of Lord of the Rings :D</figcaption> 
        
        Warning: Québec used to be a fortress built on top of a hill :D I'd ask Google Maps to show me a nearby grocery store. It'd show me that it's not so far away\! So I'd go biking off happily, only to end up carrying a bike and groceries up and down “les escaliers de la pente douce” (The stairs of the soft slope, which was not at all soft :D)   
        ![Escaliers de la pente not so douce](/blog/2024-summer-travels/img/quebec/EscaliersTrim.webp)
        <figcaption>Escaliers de la pente not so douce if you'll pardon my French :O</figcaption>

        One time I decided to bike 25 km to Marais du Nord. That was an interesting decision :D The marsh was okay. The post-trip leg pains were monumental :D   
        
        ![Marais du Nord](/blog/2024-summer-travels/img/quebec/MaraisTrim.webp)
        <figcaption>Marais du Nord. Very Game of Thrones name. Nice birds, horrible mosquitos ;-;</figcaption>

        That said, I also stopped at the Huron-Wendat museum while I was to the north of Charlesbourg. Forced myself to get the French tour even though I was nervous. I couldn't understand how rapidly my guide Daphné spoke at first. Though I got used to it pretty quickly. Glad I got into that habit. Turns out that I really like guided tours in general. And I wouldn't even have tried a single one without my goal of learning French :D I kept doing French tours throughout the rest of my trip. One interesting note for you: if you're in Canada and you speak French \- you're MUCH more likely to get private tours. Especially if you go to places on rainy days where all the local francophones are too smart to show up :D  
        
        ![Garisson in Québec](/blog/2024-summer-travels/img/quebec/CitadelleTrim.webp)
        <figcaption>Awkward photo at La Citadelle de Québec because the tour guide was waiting on only me :D</figcaption>

        ## Brigitte and Ghislain

        Brigitte and Ghislain were basically the best hosts I could ask for (and that I met for my entire trip :O). I really felt more like I was with a host family than with AirBnB hosts. Brigitte was very mothering since they also had their own daughters just ten years older than me. Ghislain was the most thirty-year-old-seeming 60-year-old you've never met in your life :O I was a developer and he wasn't, so I'd try to simplify what I did when describing my work to him. Then, he'd surprise me by starting to talk about failures in cryptographic security with the advent of quantum computers and I'd be like :OOOOO The icing on the cake was that their French was easy for me to understand from ~~day~~ all-too-late-night one :D

        <button data-src="/blog/2024-summer-travels/audio/quebec/Dot com era (35s).mp3" class="narration-button">
            Dot com era adventures
        </button>

        We were lucky enough to have dinner together twice. Nevermind the “you're only as good as your training” BS. I rose up to the occasion\! Prettiest meals I've ever cooked for someone on the very first time I tried :D   
        
        ![Aesthetic dinner](/blog/2024-summer-travels/img/quebec/DinnerTrim.webp)  
        <figcaption>I basically never take photos of food so pardon the underwhelming backdrop</figcaption>

        I have such a heartwarming lovely picture of us at the last dinner, even though I forgot to smile for the camera :D Also, turns out they quite like Indian food \- as I've already noted in life, thank the universe for Indian food \- one of the best ways to make friends :D The dinners also let us talk about the more personal stuff like politics and I was quite surprised how much a twenty year old gen zoomer and sixty year old boomers can have in common :D All things considered, I'm even more glad and lucky to have met Brigitte and Ghislain now than when I started the trip :-)

        ## Meeting Students

        I had a pretty hard time meeting students to be honest. Most of the clubs I found were pretty inactive and the entire university was summarised to me as “vide” (empty) during the summer. I did see a random facebook post for a group mural painting activity thingy and just randomly showed up. To my great chagrin, the activity combined three fears all at once: talking to girls, talking to pretty girls, and talking to pretty girls in French :O Anyways, Noémie and Laurence were quite a bit more talented at drawing than I was. Laurence drew this incredible sunset. I drew the fake “symbole chinois” since they didn't bother to ask for details :D  
        
        ![Mural at Université de Laval](/blog/2024-summer-travels/img/quebec/UniLavalTrim.webp) 
        <figcaption>I like to play a game where I ask people to guess which one I drew. No one's ever guessed right :D</figcaption>

        I also got to meet Nathaniel from the AI club at Université Laval. I got to have my “talk to someone about the oncoming AI singularity” conversation of the trip :D It was interesting how different our viewpoints were. It was one of many times where I met people and thought: “**Hey, this person lives life totally differently than me. I appreciate learning something new here\! Boy, would I not like to have their life though :D**” I will say, though, Nathaniel seemed a lot more happy and focused on the present. I wish him good luck with his grad studies ~~and running from the AI overlords :D~~  
        
        Also, funny story \- my French was @\#$\!() as usual with Nathaniel, but I managed to communicate. Over time, I built up confidence and started talking to the other people visiting Nathaniel's club (we were at a science fair type event). I proceeded to give this one girl a fluent French intro to the club, felt so proud, and then her mom starts talking to her in English with an American accent and I feel like a dunce realising they're Ohlahomians who didn't understand a word of what I said :D Though I perked right up after hearing Nathaniel giving them instructions in English and realising his English was just as @\#$@& as my French :D

        ![Random flower montage from the botanical gardens at Université Laval](/blog/2024-summer-travels/img/quebec/FlowersTrim.webp)
        <figcaption>Random flower montage from the under-rated botanical gardens at Université Laval. Ghislain gave me an illustrated bande-dessiné of Sapiens to read, which I rather quite enjoyed in the evening sun after my photography session :-)</figcaption>
        `
    },
    'intervals': {},
    'playingMusic': {
        'audio': {}
    }, 
    'unplayedMusic': {
        'audio': {
            '/blog/2024-summer-travels/audio/music/Amusement Park by Pecan Pie.mp3': null,
            '/blog/2024-summer-travels/audio/music/Bring it on By Noise Cake.mp3': null,
            '/blog/2024-summer-travels/audio/music/Dorisha by Mountaineer.mp3': null,
            '/blog/2024-summer-travels/audio/music/Nod Your Head by Hey Pluto.mp3': null,
            '/blog/2024-summer-travels/audio/music/Stage 2 by Mountaineer.mp3': null,
            '/blog/2024-summer-travels/audio/music/Still by Ilya Kuznetsov.mp3': null,
            '/blog/2024-summer-travels/audio/music/Summer Bumble by Paul Yudin.mp3': null,
        }
    },
    'playedMusic': {
        'audio': {}
    },
    'flags': {
        'musicSkip': true
    }
};

window.inspectSTATE = STATE;

async function loadSection(section, delay = 0, callback = () => null,
    enableCache = true, refreshCache = false) {
    /*
    Controller function to initiate the loading of a section's media files.
    
    Arguments:
    section (type: string)
    - Name of section to load. Must correspond to valid key in STATE object.
    
    delay (type: number, default: 0)
    - Specify the amount of delay in milliseconds between each file.
    
    callback (type: function, default: () => null)
    - Function to execute after all media files have been loaded.
    - If using background loading, specify a function that just notes the section
      has been loaded and the next section can start background loading.
    - If using urgent loading, specify a function that starts DOM rendering.

    enableCache (type: boolean, default: true)
    - If true, media files will be searched for and cached in memory.

    refreshCache (type: boolean, default: false)
    - If true, media files will be reloaded from the server and recached.
    */

    // Ensure section is valid
    if (!(section in STATE)) {
        console.error(`Invalid section: ${section}`);
        return;
    }

    // Check if cache API is available in current browser
    let cache;
    if (enableCache && 'caches' in window) {
        cache = await caches.open(`madhavmalhotra-blog-summer-2024-travels-${section}`);
    } else cache = null;

    // Go through img, audio, video sections
    const mediaTypes = Object.keys(STATE[section]);
    for (let type of mediaTypes) {
        if (type === 'md') continue;

        // Get all media files for current type
        const mediaFiles = Object.keys(STATE[section][type]);
        for (let file of mediaFiles) {

            // Load media file
            let response = null;
            if (cache && !refreshCache) response = await cache.match(file);
            if (!response) {
                response = await fetch(file);
                if (!response.ok) {
                    console.error(`Failed to load media file: ${file}`);
                    return;
                }
                if (cache) await cache.put(file, response.clone());
            }

            // Store response in STATE object and wait 0.1s if background loading
            STATE[section][type][file] = await response.blob();
            if (delay > 0) {
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }
    }
    
    // Execute callback function upon succesful load
    callback();
}

export { loadSection, STATE };