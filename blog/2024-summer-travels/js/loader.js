const STATE = {
    '0': {
        'img': {
            '/blog/2024-summer-travels/img/0/banff-mountain.webp': null,
            '/blog/2024-summer-travels/img/0/jasper-lake-2.webp': null,
            '/blog/2024-summer-travels/img/0/campbell-river-dock.webp': null,
            '/blog/2024-summer-travels/img/0/sunset-beach-vancouver.webp': null,
            '/blog/2024-summer-travels/img/0/train-kamloops.webp': null,
            '/blog/2024-summer-travels/img/0/train-winnipeg.webp': null,
            '/blog/2024-summer-travels/img/0/ubc-rose-garden-vancouver.webp': null
        },
        'audio': {
            '/blog/2024-summer-travels/audio/0/Housekeeping (45s).mp3': null,
            '/blog/2024-summer-travels/audio/0/Xinjiang by Zimpzon.mp3': null
        },
        'md': null
    },
    'quebec': {
        'img': {
            '/blog/2024-summer-travels/img/quebec/CitadelleTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/DinnerTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/EscaliersTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/FlowersTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/GrassyHouseTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/LongshotChateauTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/MaraisTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/QuebecBridgeTrim.webp': null,
            '/blog/2024-summer-travels/img/quebec/UniLavalTrim.webp': null,
        },
        'audio': {
            '/blog/2024-summer-travels/audio/quebec/Art inspiration (1m).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Dot com era (35s).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Sentier (1m).mp3': null,
            '/blog/2024-summer-travels/audio/quebec/Trip context (1m).mp3': null,
        },
        'md': `
        # Ville de Qu√©bec

        <button data-src="/blog/2024-summer-travels/audio/quebec/Trip context (1m).mp3" class="narration-button">
            Why I went on this trip
        </button>
        <button data-src="/blog/2024-summer-travels/audio/quebec/Art inspiration (1m).mp3" class="narration-button narration-button-gap">
            Why I made this site
        </button>

        ![Longshot of Le Ch√¢teau Frontenac](/blog/2024-summer-travels/img/quebec/LongshotChateauTrim.webp)
        <figcaption>Long shot of Le Ch√¢teau Frontenac from a ferry</figcaption>

        ## Travels

        I'm surprised looking back at how nervous I was when I first got to Qu√©bec. I didn't feel comfortable speaking French and I didn't really know what to expect. I tend to go 0 to 100 real quick in a lot of domains. I guess that includes "easing into" my first solo trip &#128517;
        
        I remember feeling nervous as I paid thousands of dollars for my AirBnB (my first purchase that large) thinking: ‚ÄúWow, am I really doing this? There's literally nothing to determine whether to press the button other than what my heart decides.‚Äù 

        <blockquote>Foreshadowed lesson: press the @\#(\*\#@$ button\!</blockquote>

        As I arrived in Qu√©bec, tiny things started to go right to ease my nervousness. First off, I was living in such a lucky middlespot between Universit√© Laval and Vieux Qu√©bec. My hosts were kind enough to lend me their bike, so I biked everywhere. **Every destination had a journey of literal effort behind it. It made me appreciate each expedition that much more**. I was especially lucky that Ghislain and Brigitte lived right on a bike-only road. So I'd just explore \- start riding in one direction to see how far the road went and then do the same in the other.   
        
        <button data-src="/blog/2024-summer-travels/audio/quebec/Sentier (1m).mp3" class="narration-button">
            Hidden jewels in the city
        </button>

        ![Pont de Qu√©bec](/blog/2024-summer-travels/img/quebec/QuebecBridgeTrim.webp)
        <figcaption>Pont de Qu√©bec to the East. It's nice to bike to next to the river :-)</figcaption> 

        ![Random grass-covered house](/blog/2024-summer-travels/img/quebec/GrassyHouseTrim.webp) 
        <figcaption>Pretty house en route to Universit√© Laval to the West. It reminded me of Lord of the Rings &#128513;</figcaption> 
        
        Warning: Qu√©bec used to be a fortress built on top of a hill. I'd ask Google Maps to show me a nearby grocery store. It'd show me one just a kilometre away, so I'd go biking off happily\! Little did I know I'd end up carrying a bike AND groceries up and down ‚Äúles escaliers de la pente douce‚Äù (The stairs of the "soft" slope &#128558;)
        
        ![Escaliers de la pente not so douce](/blog/2024-summer-travels/img/quebec/EscaliersTrim.webp)
        <figcaption>Escaliers de la pente not so douce if you'll pardon my French &#128517;</figcaption>

        Sidenote: you don't know true embarrassment until you're at the grocery store holding up people at the self-checkout and you realise you don't know how to say "kale" in French and then the associate comes over like "T'as besoin de l'aide?" and you're like "Yes, but I don't know how to ask you for the help I need because I wasn't paying attention during the Duolingo lesson on kale &#128557;" and then you just stand there awkwardly as he just pieces together the situation and he's like "Ahh, chou-frise" &#128128;&#128558;&#128557;

        One time I decided to bike 25 km to Marais du Nord. That was an interesting decision &#128517; The marsh was okay. The post-trip leg pains were monumental &#128558;   
        
        ![Marais du Nord](/blog/2024-summer-travels/img/quebec/MaraisTrim.webp)
        <figcaption>Marais du Nord. Very Game of Thrones name. Nice birds, horrible mosquitos ;-;</figcaption>

        That said, I also stopped at the Huron-Wendat museum while I was to the north of Charlesbourg. I forced myself to get the French tour even though I was nervous. I couldn't understand how rapidly my guide Daphn√© spoke at first. Surprisingly, I got used to it after a while! 
        
        I'm glad I got into that habit. Turns out that I really like guided tours! I didn't know this since my family doesn't like staying long at museums. And I wouldn't even have tried a single one without my goal of learning French. I kept doing French tours throughout the rest of my trip. 
        
        One sidenote for you: if you're in Canada and you speak French \- you're MUCH more likely to get private tours. Especially if you go to places on rainy days where all the local francophones are too smart to show up &#128517;  
        
        ![Garisson in Qu√©bec](/blog/2024-summer-travels/img/quebec/CitadelleTrim.webp)
        <figcaption>Awkward photo at La Citadelle de Qu√©bec because the tour guide was waiting on <i>only</i> me &#128128;</figcaption>

        ## Brigitte and Ghislain

        Brigitte and Ghislain were basically the best hosts I could ask for. I really felt more like I was with a host family than with AirBnB hosts! 
        
        Brigitte was very mothering since they also had their own daughters just ten years older than me. Ghislain was the most 30-year-old-seeming 60-year-old you've never met in your life üòÆ I was a developer and he worked in business. So I'd try to simplify what I did when describing my work to him. Then, he'd surprise me by talking about failures in cryptographic security with the advent of quantum computers and I'd be like :OOOOO

        <button data-src="/blog/2024-summer-travels/audio/quebec/Dot com era (35s).mp3" class="narration-button">
            Dot com era adventures
        </button>

        We were lucky enough to have dinner together twice. Nevermind the ‚Äúyou're only as good as your training‚Äù BS. I rose up to the occasion\! Prettiest meals I've ever cooked for someone on the very first time I tried &#128513;   
        
        ![Aesthetic dinner](/blog/2024-summer-travels/img/quebec/DinnerTrim.webp)  
        <figcaption>I basically never take photos of food so pardon the underwhelming backdrop</figcaption>

        I have such a heartwarming lovely picture of us at the last dinner, even though I forgot to look at the camera :/ Also, turns out they quite like Indian food. As I've already noted in life, thank the universe for Indian food: one of the most universal ways to make friends &#128517; 
        
        The dinners also let us talk about the more personal stuff like politics. I was quite surprised how much a twenty year old zoomer and sixty year old boomers can have in common! All things considered, I'm even more glad and lucky to have met Brigitte and Ghislain now than when I started the trip :-)

        ## Meeting Students

        I had a pretty hard time meeting students to be honest. Most of the clubs I found were pretty inactive. The entire university was summarised to me as ‚Äúvide‚Äù (empty) during the summer. 
        
        I did see a random facebook post for a group mural painting activity thingy and just randomly showed up. To my great chagrin, the activity combined three fears all at once: talking to girls, talking to pretty girls, and talking to pretty girls in French &#128558; Anyways, No√©mie and Laurence were much more talented at drawing than I was. Laurence drew this incredible supernova sunset. I drew the fake "symbole chinois" since they didn't bother to ask for details &#128517;  
        
        ![Mural at Universit√© de Laval](/blog/2024-summer-travels/img/quebec/UniLavalTrim.webp) 
        <figcaption>I like to play a game where I ask people to guess which one I drew. No one's ever guessed right &#128513;</figcaption>

        I also got to meet Nathaniel from the AI club at Universit√© Laval. That was nice. I finally had my ‚Äútalk to someone about the oncoming AI singularity‚Äù conversation of the trip &#128517; It was interesting how different our viewpoints were. It was one of many times where I met people and thought: ‚Äú**Hey, this person lives life totally differently than me. I appreciate learning something new here\! But boy, I would not like to have their life &#128517;**‚Äù I will say, though, Nathaniel seemed a lot more happy and focused on the present. I wish him good luck with his grad studies ~~and running from the AI overlords :D~~  
        
        Also, funny story \- my French was @\#($\!) as usual with Nathaniel, but I managed to communicate. Over time, I built up confidence and started talking to the other people visiting Nathaniel's club (we were at a science fair type event). I proceeded to give this one girl a fluent French intro to the club, felt so proud, and then her mom starts talking to her in English with an American accent and I feel like a dunce realising they're Ohlahomians who didn't understand a word of what I'd said &#128557; Though I perked right up after hearing Nathaniel giving them instructions in English and realising his English was just as @\#$@& as my French &#128513;

        ![Random flower montage from the botanical gardens at Universit√© Laval](/blog/2024-summer-travels/img/quebec/FlowersTrim.webp)
        <figcaption>Random flower montage from the under-rated botanical gardens at Universit√© Laval. Ghislain gave me an illustrated bande-dessin√© of Sapiens to read, which I rather quite enjoyed in the evening sun after my photography session :-)</figcaption>
        `
    },
    'intervals': {},
    'playingMusic': {
        'audio': {}
    }, 
    'unplayedMusic': {
        'audio': {
            "/blog/2024-summer-travels/audio/music/Still by Ilya Kuznetsov.mp3": null,
            "/blog/2024-summer-travels/audio/music/Indi's Waltz by John Hayes.mp3": null,
            "/blog/2024-summer-travels/audio/music/East Side Horns by Pecan Pie.mp3": null,
            "/blog/2024-summer-travels/audio/music/Nod Your Head by Hey Pluto.mp3": null,
            "/blog/2024-summer-travels/audio/music/Awakening by Roo Walker.mp3": null,
            "/blog/2024-summer-travels/audio/music/O by Arnito.mp3": null,
            "/blog/2024-summer-travels/audio/music/Amusement Park by Pecan Pie.mp3": null,
            "/blog/2024-summer-travels/audio/music/Dorisha by Mountaineer.mp3": null,
            "/blog/2024-summer-travels/audio/music/Moonlake by Simon Folwar.mp3": null,
            "/blog/2024-summer-travels/audio/music/Summer Bumble by Paul Yudin.mp3": null,
            "/blog/2024-summer-travels/audio/music/Smoke Me by ATM.mp3": null,
            "/blog/2024-summer-travels/audio/music/Flowing Waters by HLFMN.mp3": null,
            "/blog/2024-summer-travels/audio/music/The Cleaner by Night Drift.mp3": null,
            "/blog/2024-summer-travels/audio/music/Sapporo by Locran.mp3": null,
            "/blog/2024-summer-travels/audio/music/Wonder by Paint the skies.mp3": null,
            "/blog/2024-summer-travels/audio/music/Fuzz Buzz by Soundroll.mp3": null,
            "/blog/2024-summer-travels/audio/music/Ragueria by Arnito.mp3": null,
            "/blog/2024-summer-travels/audio/music/Dirty Games by Hybridas.mp3": null,
            "/blog/2024-summer-travels/audio/music/Funk Me by Soundroll.mp3": null,
            "/blog/2024-summer-travels/audio/music/Funky Day by Infraction.mp3": null,
            "/blog/2024-summer-travels/audio/music/Pistol Swing by Soundroll.mp3": null,
            "/blog/2024-summer-travels/audio/music/Summer Nights by Hey Pluto.mp3": null,
            "/blog/2024-summer-travels/audio/music/Flow of the Ganges by Simon Folwar.mp3": null,
            "/blog/2024-summer-travels/audio/music/Tropicana by Soundroll.mp3": null,
            "/blog/2024-summer-travels/audio/music/New Beginnings by Philip Anderson.mp3": null,
            "/blog/2024-summer-travels/audio/music/Add the butter by Night Drift.mp3": null,
            "/blog/2024-summer-travels/audio/music/Empty Moon by Ian Aisling.mp3": null,
            "/blog/2024-summer-travels/audio/music/Bring it on By Noise Cake.mp3": null,
            "/blog/2024-summer-travels/audio/music/Stage 2 by Mountaineer.mp3": null
          }
    },
    'playedMusic': {
        'audio': {}
    },
    'flags': {
        'musicSkip': true
    }
};

window.inspectSTATE = STATE;

async function loadSection(section, delay = 0, callback = () => null,
    enableCache = true, refreshCache = false) {
    /*
    Controller function to initiate the loading of a section's media files.
    
    Arguments:
    section (type: string)
    - Name of section to load. Must correspond to valid key in STATE object.
    
    delay (type: number, default: 0)
    - Specify the amount of delay in milliseconds between each file.
    
    callback (type: function, default: () => null)
    - Function to execute after all media files have been loaded.
    - If using background loading, specify a function that just notes the section
      has been loaded and the next section can start background loading.
    - If using urgent loading, specify a function that starts DOM rendering.

    enableCache (type: boolean, default: true)
    - If true, media files will be searched for and cached in memory.

    refreshCache (type: boolean, default: false)
    - If true, media files will be reloaded from the server and recached.
    */

    // Ensure section is valid
    if (!(section in STATE)) {
        console.error(`Invalid section: ${section}`);
        return;
    }

    // Check if cache API is available in current browser
    let cache;
    if (enableCache && 'caches' in window) {
        cache = await caches.open(`madhavmalhotra-blog-summer-2024-travels-${section}`);
    } else cache = null;

    // Go through img, audio, video sections
    const mediaTypes = Object.keys(STATE[section]);
    for (let type of mediaTypes) {
        if (type === 'md') continue;

        // Get all media files for current type
        const mediaFiles = Object.keys(STATE[section][type]);
        for (let file of mediaFiles) {

            // Load media file
            let response = null;
            if (cache && !refreshCache) response = await cache.match(file);
            if (!response) {
                response = await fetch(file);
                if (!response.ok) {
                    console.error(`Failed to load media file: ${file}`);
                    return;
                }
                if (cache) await cache.put(file, response.clone());
            }

            // Store response in STATE object and wait 0.1s if background loading
            STATE[section][type][file] = await response.blob();
            if (delay > 0) {
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }
    }
    
    // Execute callback function upon succesful load
    callback();
}

export { loadSection, STATE };